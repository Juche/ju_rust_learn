# rust 开始

## 开发环境

- 升级: `rustup update`

## rust 常识

- rust 中包称作 crate

## 编译和运行 Rust 程序

- `rustc` 适用于简单的 Rust 程序

- `cargo new` 用来创建一个新的 Cargo 程序
- `cargo build` 适用于 Cargo 程序
- `cargo run` 先编译再运行二进制文件
- `cargo check` 用来检查 Cargo 程序是否符合编译要求(比 build 快,不会生成二进制文件)
- `cargo build --release` 发布构建(会优化编译,编译时间更长,代码运行更快)

## Rust 数据类型

- 标量类型
  - 整数类型：i8、i16、i32、i64、i128、isize
  - 无符号整数类型 u8、u16、u32、u64、u128、usize
  - 浮点数类型：f32、f64
  - 布尔类型：bool
  - 字符类型：char
  - 字符串类型：&str / String
    - 字符串字面量 &str 不可变,存储在 stack 中
    - 字符串 String 可变,存储在 heap 中
- 复合类型
  - 数组类型： [T; N]
  - 元组类型： (T1, T2, ..., Tn)
  - 切片类型： [T]
  - 结构体类型： struct S { ... }
  - 枚举类型： enum E { ... }
  - 函数类型： fn(T1, T2, ..., Tn) -> R
  - 引用类型： &T、 &mut T
  - 智能指针类型： Box<T>、 Rc<T>、 Arc<T>
  - 其他类型
  - 空类型： ()
  - 未初始化类型： !
  - 动态类型： dyn Trait

## Rust 所有权

- 数据存储空间: stack 和 heap
- 所有权规则
  - copy: 任何简单的标量(组合)类型都实现了 Copy trait
  - drop: 对存储在 heap 中的数据离开作用域时进行释放, drop 和 copy 是互斥的 trait
  - move: 将 heap 中的数据从一个变量赋给另一个, 旧的变量将失效(所有权转移)
  - clone: 对存储在 heap 中的数据进行拷贝

  - reference: &T, 把引用作为参数的行为称为借用(borrow)
    - 借用的数据不可被修改
    - 除非标注 &mut T
    - 每次只能有至多一个可变的借用(防止发生数据竞争),可通过过创建不同作用域解决这个问题
    - 不可同时拥有一个可变引用和一个不可变引用

- slice: 切片(一种不持有所有权的数据类型)

## Struct

```rust
// 支持类似 js 的对象简写结构
Person {
  name,
  age,
  sex,
}

// 支持类似 js 的对象结构赋值
let person1 = Person {
  name: "张三",
  age: 18,
  sex: "男",
}

let person2 = Person {
  name: "李四",
  ...person1,
}
```

## Rust 模块系统

- Package: 一个包含多个 crate 的目录
  - Cargo.toml 文件,描述如何构建这些 Crates
  - 只能包含至多一个 library crate
  - 可以包含任意数量的 binary crate
- Crate: 一个包含多个模块的包
  - binary: 二进制类型 Crate, main.rs 或 src/bin 目录的
  - library: 库类型 Crate, lib.rs
  - Crate Root: 源代码文件,是组成 Crate 的根 Module
- Module: 一个包含多个函数的模块
  - 将 crate 的代码进行分组
  - 控制项目的私有性, `public/private`
  - 通过 `mod` 关键字建立 module, 可嵌套
- Path: 模块的路径
